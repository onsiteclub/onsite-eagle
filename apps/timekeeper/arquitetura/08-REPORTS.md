# 08 â€” Reports & Export

**Status:** Implementado
**Arquivos:** `src/reporting/renderHtml.ts` (280), `share.ts` (62), `whatsapp.ts` (147)

---

## Pipeline

```
User seleciona date range
  -> usecases/generateReport.ts
    -> Agrega day_summary + work_sessions
    -> callAI (Secretary mode='report') [opcional]
    -> renderHtml.ts (HTML)
    -> share.ts (PDF -> share picker)
```

---

## ReportModel (@onsite/shared/types/timekeeper.ts)

```typescript
interface ReportModel {
  worker: { name: string; email: string };
  period: { start: string; end: string };
  days: ReportDay[];
  totals: { hours, minutes, workDays, breakMinutes, overtimeHours };
  weeklyTotals: { weekStart: string; totalMinutes: number }[];
  aiSummary?: string;
}

interface ReportDay {
  date, dayOfWeek, firstEntry, lastExit, totalMinutes, breakMinutes,
  locationName, type: DayType, flags: DayFlag[], source: SessionSource
}
```

---

## HTML Template (renderHtml.ts)

- OnSite Club letterhead (#FF6B35)
- Worker name + periodo
- Tabela diaria (data, dia, entrada, saida, break, total, site)
- Subtotais semanais
- Grand total
- AI Summary box (se disponivel)
- Footer: "Generated by OnSite Timekeeper"
- AI-corrected entries com asterisco

---

## PDF (share.ts)

```typescript
sharePdf(html, filename): expo-print -> PDF -> expo-sharing
shareText(text): Share.share({ message: text })  // Fallback
```

---

## WhatsApp (whatsapp.ts)

Formato com emojis:
```
ğŸ“‹ *Timesheet â€” Feb 1 to Feb 14*
ğŸ‘· John Doe
âœ… 2026-02-01 (Mon)
   â° 07:15 â†’ 16:30 | â˜• 30min | *8h 45m*
ğŸ“Š *Total: 84h 30m* (10 days)
```

Tambem formatPlainText() sem emojis.

---

## AI Summary

Opcional. Se AI disponivel: narrative + flags no PDF.
Se AI falha: PDF sem summary. Graceful.

---

## Formatos

| Formato | Via | Use Case |
|---------|-----|----------|
| PDF | expo-print | Timesheet formal |
| WhatsApp | Share.share | Rapido |
| Plain text | Share.share | Email, clipboard |
